
# En library_scanner.py, despu√©s de la l√≠nea 121:

# NUEVO: Normalizar g√©nero local antes de fusionar
if 'genre' in track_info_local and track_info_local['genre'] and track_info_local['genre'] != "N/A":
    from core.metadata_enricher import MetadataEnricher
    
    # Crear instancia temporal del enricher para usar _curate_genres
    enricher = MetadataEnricher()
    
    # Aplicar normalizaci√≥n al g√©nero local
    raw_genre = track_info_local['genre']
    normalized_genres = enricher._curate_genres([raw_genre])
    
    if normalized_genres:
        track_info_local['genre'] = '; '.join(normalized_genres)
        print(f"üéØ G√©nero normalizado: '{raw_genre}' ‚Üí '{track_info_local['genre']}'")

# Continuar con la fusi√≥n original
final_data_for_db.update(track_info_local)
